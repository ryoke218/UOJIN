# UOJIN 使い方マニュアル

LINE受注メッセージを解析し、Google スプレッドシートに登録するツールです。

---

## 画面構成

上部のタブで3つの画面を切り替えます。

| タブ | 内容 |
|------|------|
| **受注入力** | メインの受注処理画面 |
| **店舗マスタ** | 店舗名の登録・管理 |
| **商品マスタ** | 商品名・変換名・発注先の登録・管理 |

---

## 1. 受注入力（メイン画面）

### 基本の流れ

1. **発送日を設定**（デフォルトは翌日）
2. **処理者名を入力**（任意）
3. **LINEメッセージをコピペ**してテキストエリアに貼り付け
4. **「解析」ボタン**を押す
5. 解析結果を確認・修正
6. **「送信」ボタン**でスプレッドシートに登録
7. 「出力済み」と表示されたら完了
8. 次のメッセージを貼り付けて繰り返し

### 解析結果の見方

| 背景色 | 意味 |
|--------|------|
| 青背景 | 正常に解析された行（商品マスタに登録済み） |
| 赤背景 | エラー行（店舗名または商品名が未登録） |
| 白/灰背景 | 正常行 |

- **店舗名エラー**：店舗欄がドロップダウンになるので、正しい店舗を選択
- **商品名エラー**：商品欄に赤枠が付くので、手入力で修正

### 解析結果の修正

全ての項目（店舗名・商品名・数量・発注先）は解析後に手動で修正できます。
不要な行は右端の「x」ボタンで削除できます。

### スキップされた行

解析できなかった行はオレンジ色の警告ボックスに表示されます。
注文内容が含まれている可能性があるので、必ず確認してください。
（「よろしくお願いします」等の純粋な挨拶文は表示されません）

### 日付アラート

メッセージ内に「明日」「〇日」等の日付表現がある場合、黄色いバナーで通知されます。
発送日の設定が正しいか確認してください。

### 送信

- エラー行が残っていても送信できます（確認ダイアログが出ます）
- 送信後は「出力済み」と表示され、再送信は無効化されます
- 次のメッセージを解析すると自動的にリセットされます

### 出力ボタン

スプレッドシートに登録済みのデータを一覧表示します。
3つのビューを切り替えられます：

- **発注先別**：発注先ごとにグループ化
- **店舗別**：店舗ごとにグループ化
- **商品別**：商品ごとにグループ化

印刷ボタンで紙に印刷することもできます。

### クリアボタン

テキスト・解析結果・発送日を全てリセットします。

---

## 2. 店舗マスタ

LINEメッセージに出てくる店舗名を登録します。

| 項目 | 説明 |
|------|------|
| **入力名** | LINEメッセージに出てくる表記（完全一致でマッチ） |
| **正式店舗名** | スプレッドシートに出力される名前 |

### ポイント

- 同じ店舗でも複数の入力名を登録できます
  - 例：「コマル」「コマルです」「コマルです。」→ 全て正式名「コマル」
- LINEメッセージの表記と**完全一致**で判定されます

### 操作

- **追加**：入力名と正式店舗名を入力して「追加」
- **編集**：「編集」→ 内容を修正 →「保存」
- **削除**：「削除」→ 確認ダイアログで承認

---

## 3. 商品マスタ

LINEメッセージに出てくる商品名を登録します。

| 項目 | 説明 |
|------|------|
| **正式商品名** | LINEメッセージの行頭で前方一致マッチする名前 |
| **変換名** | スプレッドシートに出力される名前（空欄なら正式商品名がそのまま出力） |
| **発注先** | 発注先（任意） |

### ポイント

- 商品名は**前方一致**で判定されます
  - 例：「えびあつまげ1」→ 商品名「えびあつまげ」にマッチ、数量「1」
- 長い商品名が優先されます
  - 例：「養殖真鯛」と「真鯛」が両方登録されている場合、「養殖真鯛」が優先
- **変換名**を設定すると、スプレッドシートには変換名が出力されます
  - 例：正式商品名「本鮪」、変換名「本マグロ」→ スプレッドシートには「本マグロ」
- 商品名の後ろのテキストは全て「数量」欄に入ります
  - 例：「鯵1kg」→ 商品名「鯵」、数量「1kg」

---

## 4. 解析ルール

### メッセージの構造

```
店舗名（1行目）
商品名+数量（2行目以降）
商品名+数量
...

店舗名（次の注文）
商品名+数量
...
```

### LINEタイムスタンプ

`10:08 原 勇樹 ゆもとさん` のようなLINEのタイムスタンプ行は自動的に処理され、末尾の店舗名が検出されます。

### 空行

空行はブロックの区切りとして扱われます。店舗と商品のグループを分けます。

---

## 5. スプレッドシート

### データの保存先

- 発送日ごとにシートが自動作成されます（例：「2026-02-15」）
- 送信するたびにデータが追記されます

### 出力カラム

| A | B | C | D | E | F | G |
|---|---|---|---|---|---|---|
| 発送日 | 店舗名 | 商品名 | 数量 | 発注先 | 処理者 | 登録日時 |

- C列の「商品名」には変換名が設定されていれば変換名が出力されます

### マスタデータ

店舗マスタ・商品マスタもスプレッドシートに保存されています。
アプリから変更するとスプレッドシートに即反映され、スプレッドシートを直接編集した場合もアプリをリロードすれば反映されます。
